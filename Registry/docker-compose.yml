version: '3'

services:
  registry:
    image: registry:2
    container_name: local-registry
    restart: always
    ports:
      - "5000:5000"
    networks:
      - app-net 
    volumes:
      - registry_data:/var/lib/registry
      - /opt/auth:/auth
    environment:
      REGISTRY_HTTP_RELATIVEURLS: "true"
      REGISTRY_AUTH: htpasswd
      REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd
      REGISTRY_AUTH_HTPASSWD_REALM: Registry Realm
      REGISTRY_STORAGE_DELETE_ENABLED: "true"
      REGISTRY_HTTP_HEADERS_ACCESS-CONTROL-ALLOW-ORIGIN: '["https://registry.giusoft.com.br"]'
      REGISTRY_HTTP_HEADERS_ACCESS-CONTROL-ALLOW-METHODS: '[HEAD,GET,OPTIONS,DELETE]'
      REGISTRY_HTTP_HEADERS_ACCESS-CONTROL-ALLOW-HEADERS: '[Authorization,Accept,Cache-Control]'
      REGISTRY_HTTP_HEADERS_ACCESS-CONTROL-EXPOSE-HEADERS: '[Docker-Content-Digest]'

  registry-ui:
    image: joxit/docker-registry-ui:latest
    container_name: registry-ui
    restart: always
    ports:
      - "8080:80"
    networks:
      - app-net 
    environment:
      - REGISTRY_TITLE=Registry GiuSoft
      - REGISTRY_URL=https://registry.giusoft.com.br
      - DELETE_IMAGES=true
      - SINGLE_REGISTRY=true
    depends_on:
      - registry

networks:
  app-net:
    external: true 

volumes:
  registry_data:
